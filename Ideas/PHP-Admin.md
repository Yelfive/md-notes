#  Some ideas about Laravel Admin extension

## Model

1. `$form/$grid` translation uses `Model::getAttributeLabels();` by default
2. `$form` rules use `Model::rules` by default

## Form

1. Use selector to locate HTML element, like jQuery

   ```php
   // Laravel Admin can only specify some fixed elements' properties:
   //
   // <div class="readonly">
   //     <input readonly="readonly" />
   //  </div>
   $form->file()->readonly();

   // Expect: allow to locate element by selector
   // <input readonly="readonly">
   $form->file()->findInput('selector')->readonly();
   ```

2. Validation should have `keyup/change` listeners

   To validate corresponding rules as specified by `$form->rules` or `Model::rules`. `Laravel Admin` does not have such mechanism, it validates only in the backend.

3. `Form` SHOULD have access to the value of current record, when it's editing.
   
   ```php
   $form->tools(function (Form\Tools $tools) {
      /** @var Form $this */
      // Not allowed to delete super user.
      if ($this->model()->id === 1) $tools->disableDelete();

      if ($this->isEditing()) (new Button())
            ->setIcon('fa-credit-card')
            // Needs $model->id to generate link
            ->setAction([BankCardController::class, 'index'], ['user' => $this->model()->id])
            ->appendTo($tools);
   });
   ```

   This can be achieved in `Laravel Admin` by the following code

   ```php
   $form = new Form(User::findOrFail($id));
   ```
   
   However, when `$form->edit($id)` is called, the same data will be queried a second time, which may cause significant database overheads.

4. `Laravel Admin` prepares form data after validation. For example,

   ```php
   // Controller
   $form->switch('is_boolean');
   ```

   Inside class `\Encore\Admin\Form`,

   1. `Form::store` -> `Form::validationMessages`-> `Form::prepareInsert`
   2. `Form::update` -> `Form::validationMessages` -> `Form::prepareUpdate`

      ```php
      // 1. validation
      $this->validationMessages();
      // 2. prepare
      $field->prepare($value);
      ```

   This makes rules of model generated by command `reference:model` cannot be applied by such `store,update` methods, because for some fields, `switch` for example, the client posts `on/off` as value to the server, which validates, then `prepares` the value into `1/0`, finally saves it into database.

   **Expectation**

   `Field::prepare` **MUST** be called before `\Encore\Admin\Form::validationMessages` to keep consistent to `Laravel` and `reference:model`, if it is still needed.

## Grid

1. Link on field

   ```php
   // generate a link to redirect to edit/view page on `name` field
   $grid->column('name')->linkToEditPage();
   ```

2. `Grid/Form` should query required fields, not the all of the table.
e.g.

   ```php
   $grid->column('id');
   $grid->column('name');
   ```
   
   Should generate
   
   ```sql
   SELECT id, name FROM table_name;
   -- other than
   SELECT * FROM table_name;
   ```

## 3. `Laravel-admin` uses pjax, which has bug with PHP

Consider this example

```php
<?php

$dom = new \DOMDocument('1.0', 'utf-8');
$dom->loadHTML(<<<HTML
<script>
let a = <span>123</span>
</script>
HTML
);

echo $dom->saveHTML();
```

will result:

```html
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><head><script>
let a = '<span>123';
</script></head></html>
```

with **closing tag removed**. In fact, everything after the closing tag is removed too.

`Laravel-Admin` uses `\Symfony\Component\DomCrawler\Crawler`, which uses `\DOMDocument`, which uses `libxml` to get `pjax` container's content. And this is a known bug with `libxml`, which does not support `HTML5`.

With this bug under consideration, the pjax response passing should take place at browser side, instead of server side.

### 4. Allows `$form->text()->ignore()`

Currently supported syntax:

```php
$form->text('should-be-ignored');
$form->ignore('should-be-ignored');
```

Expected:

```php
$form->text('should-be-ignored')->ignore();
```

to ignore specific field.

## Binding `Form` as `$this`

*Laravel Admin* binds class `Form` to callbacks as `$this`, and such behavior makes calling methods from controller inside callbacks troublesome.

DO NOT bind anything, just variables passing.

```php
// source code
$this->$callback($value, $form);

// usage
$column->display(function ($value, Form $form) {
   $this->methodInController();
});
```

## Command `reference:model`

1. SHOULD be able to use `TableNameContract` and `TableName` model strategy and create those two files simultaneously.

## Command `trans:extract`

1. **SHOULD** be able to extract one file.
2. **SHOULD** compare change of file before extracting, e.g. extract `UserController` only when changed.

## Command `model:label`

1. Generate locale method `getAttributeLabels` for a model, SHOULD be considered being **ABLE** to be included inside `reference:model`
2. SHOULD allow to customize map for model fields, fx.  `created_at` will be `__('Created at')` instead of `__(table-name.Created at)`


## Command `map:const`

Generate labels for model constants, SHOULD be considered being **ABLE** to be included inside `reference:model`
