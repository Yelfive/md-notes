# Thread later half

## 内存模型

### 三大特性

1. 原子性
2. 可见性
3. 有序性

### 先行发生原则

1. 单一线程原则
2. 管程锁定规则
3. `volatile` 变量规则
4. 线程启动规则
5. 线程加入规则
6. 线程中断规则
7. 线程终结规则
8. 传递性

## 锁类型

synchronized & ReentrantLock 是互斥同步，也成阻塞同步，悲观锁。

- 悲观锁：总认为资源会被抢占。
- 乐观锁：尝试操作，成功则退出，失败则再次尝试

## 非阻塞同步

1. CAS
2. AtomicInteger
3. ABA

### 1. CAS

> Compare-and-Swap

乐观锁需要操作和冲突检测这两个步骤具备原子性，这里就不能再使用互斥同步来保证了，只能靠硬件来完成。硬件支持的原子性操作最典型的是：比较并交换（Compare-and-Swap，CAS）。CAS 指令需要有 3 个操作数，分别是内存地址 V、旧的预期值 A 和新值 B。当执行操作时，只有当 V 的值等于 A，才将 V 的值更新为 B。

### 2. AtomicInteger

### 3. ABA

## JVM 对 synchronized 的优化

1. 自旋锁
2. 锁消除
3. 锁粗化
4. 轻量级锁
5. 偏向锁
